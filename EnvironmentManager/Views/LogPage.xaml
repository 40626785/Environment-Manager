<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="EnvironmentManager.Views.LogPage"
             Title="Log Viewer">

        <Grid Padding="20"
                        RowDefinitions="Auto,*">

                <!-- Top Section: Filter Controls -->
                <VerticalStackLayout Grid.Row="0"
                                Spacing="10">
                        <ActivityIndicator IsRunning="{Binding IsBusy}"
                                        IsVisible="{Binding IsBusy}"
                                        Color="DarkRed"/>

                        <Button Text="{Binding ToggleFilterText}"
                                        Command="{Binding ToggleFilterVisibilityCommand}"/>

                        <ScrollView IsVisible="{Binding IsFilterVisible}"
                                        HeightRequest="280">
                                <VerticalStackLayout Spacing="10"
                                                Padding="5">

                                        <!-- ID Range -->
                                        <Label Text="Start ID:"/>
                                        <Entry Keyboard="Numeric"
                                                        Text="{Binding StartIdText}"
                                                        Placeholder="e.g. 1"/>

                                        <Label Text="End ID:"/>
                                        <Entry Keyboard="Numeric"
                                                        Text="{Binding EndIdText}"
                                                        Placeholder="e.g. 100"/>

                                        <!-- Date Filter -->
                                        <HorizontalStackLayout>
                                                <Label Text="Enable Date Filter"
                                                                VerticalOptions="Center"/>
                                                <Switch IsToggled="{Binding IsDateFilterEnabled}"/>
                                        </HorizontalStackLayout>

                                        <Label Text="Start Date:"/>
                                        <DatePicker Date="{Binding StartDate}"/>

                                        <Label Text="End Date:"/>
                                        <DatePicker Date="{Binding EndDate}"/>

                                        <Button Text="Apply Filters"
                                                        Command="{Binding ApplyFiltersCommand}"
                                                        BackgroundColor="Blue"
                                                        TextColor="White"/>
                                        <Button Text="Export to CSV"
                                                        Command="{Binding ExportToCsvCommand}"
                                                        BackgroundColor="Green"
                                                        TextColor="White"/>

                                </VerticalStackLayout>
                        </ScrollView>

                        <Button Text="Delete Filtered Logs"
                                        Command="{Binding DeleteFilteredCommand}"
                                        BackgroundColor="Red"
                                        TextColor="White"/>
                </VerticalStackLayout>

                <!-- Bottom Section: Log List -->
                <CollectionView Grid.Row="1"
                                ItemsSource="{Binding TableData}">
                        <CollectionView.ItemTemplate>
                                <DataTemplate>
                                        <Frame Margin="5"
                                                        Padding="10"
                                                        BorderColor="LightGray"
                                                        CornerRadius="10">
                                                <VerticalStackLayout>
                                                        <Label Text="{Binding LogID, StringFormat='ID: {0}'}"
                                                                        FontAttributes="Bold"/>
                                                        <Label Text="{Binding LogDateTime, StringFormat='{0:dd MMM yyyy HH:mm:ss}'}"/>
                                                        <Label Text="{Binding LogMessage}"
                                                                        LineBreakMode="WordWrap"/>
                                                </VerticalStackLayout>
                                        </Frame>
                                </DataTemplate>
                        </CollectionView.ItemTemplate>
                </CollectionView>

        </Grid>
</ContentPage>
